{"version":3,"file":"js/376-legacy.b9b3702c.js","mappings":"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","sources":["webpack://protezione-civile/./node_modules/core-js/internals/flatten-into-array.js","webpack://protezione-civile/./node_modules/core-js/modules/es.array.flat-map.js","webpack://protezione-civile/./node_modules/core-js/modules/es.array.splice.js","webpack://protezione-civile/./node_modules/core-js/modules/es.array.unscopables.flat-map.js","webpack://protezione-civile/./src/services/AdminService.ts","webpack://protezione-civile/./src/services/NotificationService.ts","webpack://protezione-civile/./src/views/NewTopic.vue?5fc3","webpack://protezione-civile/./src/views/NewTopic.vue?d7cd","webpack://protezione-civile/./src/views/NewTopic.vue"],"sourcesContent":["'use strict';\nvar global = require('../internals/global');\nvar isArray = require('../internals/is-array');\nvar lengthOfArrayLike = require('../internals/length-of-array-like');\nvar bind = require('../internals/function-bind-context');\n\nvar TypeError = global.TypeError;\n\n// `FlattenIntoArray` abstract operation\n// https://tc39.github.io/proposal-flatMap/#sec-FlattenIntoArray\nvar flattenIntoArray = function (target, original, source, sourceLen, start, depth, mapper, thisArg) {\n  var targetIndex = start;\n  var sourceIndex = 0;\n  var mapFn = mapper ? bind(mapper, thisArg) : false;\n  var element, elementLen;\n\n  while (sourceIndex < sourceLen) {\n    if (sourceIndex in source) {\n      element = mapFn ? mapFn(source[sourceIndex], sourceIndex, original) : source[sourceIndex];\n\n      if (depth > 0 && isArray(element)) {\n        elementLen = lengthOfArrayLike(element);\n        targetIndex = flattenIntoArray(target, original, element, elementLen, targetIndex, depth - 1) - 1;\n      } else {\n        if (targetIndex >= 0x1FFFFFFFFFFFFF) throw TypeError('Exceed the acceptable array length');\n        target[targetIndex] = element;\n      }\n\n      targetIndex++;\n    }\n    sourceIndex++;\n  }\n  return targetIndex;\n};\n\nmodule.exports = flattenIntoArray;\n","'use strict';\nvar $ = require('../internals/export');\nvar flattenIntoArray = require('../internals/flatten-into-array');\nvar aCallable = require('../internals/a-callable');\nvar toObject = require('../internals/to-object');\nvar lengthOfArrayLike = require('../internals/length-of-array-like');\nvar arraySpeciesCreate = require('../internals/array-species-create');\n\n// `Array.prototype.flatMap` method\n// https://tc39.es/ecma262/#sec-array.prototype.flatmap\n$({ target: 'Array', proto: true }, {\n  flatMap: function flatMap(callbackfn /* , thisArg */) {\n    var O = toObject(this);\n    var sourceLen = lengthOfArrayLike(O);\n    var A;\n    aCallable(callbackfn);\n    A = arraySpeciesCreate(O, 0);\n    A.length = flattenIntoArray(A, O, O, sourceLen, 0, 1, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n    return A;\n  }\n});\n","'use strict';\nvar $ = require('../internals/export');\nvar global = require('../internals/global');\nvar toAbsoluteIndex = require('../internals/to-absolute-index');\nvar toIntegerOrInfinity = require('../internals/to-integer-or-infinity');\nvar lengthOfArrayLike = require('../internals/length-of-array-like');\nvar toObject = require('../internals/to-object');\nvar arraySpeciesCreate = require('../internals/array-species-create');\nvar createProperty = require('../internals/create-property');\nvar arrayMethodHasSpeciesSupport = require('../internals/array-method-has-species-support');\n\nvar HAS_SPECIES_SUPPORT = arrayMethodHasSpeciesSupport('splice');\n\nvar TypeError = global.TypeError;\nvar max = Math.max;\nvar min = Math.min;\nvar MAX_SAFE_INTEGER = 0x1FFFFFFFFFFFFF;\nvar MAXIMUM_ALLOWED_LENGTH_EXCEEDED = 'Maximum allowed length exceeded';\n\n// `Array.prototype.splice` method\n// https://tc39.es/ecma262/#sec-array.prototype.splice\n// with adding support of @@species\n$({ target: 'Array', proto: true, forced: !HAS_SPECIES_SUPPORT }, {\n  splice: function splice(start, deleteCount /* , ...items */) {\n    var O = toObject(this);\n    var len = lengthOfArrayLike(O);\n    var actualStart = toAbsoluteIndex(start, len);\n    var argumentsLength = arguments.length;\n    var insertCount, actualDeleteCount, A, k, from, to;\n    if (argumentsLength === 0) {\n      insertCount = actualDeleteCount = 0;\n    } else if (argumentsLength === 1) {\n      insertCount = 0;\n      actualDeleteCount = len - actualStart;\n    } else {\n      insertCount = argumentsLength - 2;\n      actualDeleteCount = min(max(toIntegerOrInfinity(deleteCount), 0), len - actualStart);\n    }\n    if (len + insertCount - actualDeleteCount > MAX_SAFE_INTEGER) {\n      throw TypeError(MAXIMUM_ALLOWED_LENGTH_EXCEEDED);\n    }\n    A = arraySpeciesCreate(O, actualDeleteCount);\n    for (k = 0; k < actualDeleteCount; k++) {\n      from = actualStart + k;\n      if (from in O) createProperty(A, k, O[from]);\n    }\n    A.length = actualDeleteCount;\n    if (insertCount < actualDeleteCount) {\n      for (k = actualStart; k < len - actualDeleteCount; k++) {\n        from = k + actualDeleteCount;\n        to = k + insertCount;\n        if (from in O) O[to] = O[from];\n        else delete O[to];\n      }\n      for (k = len; k > len - actualDeleteCount + insertCount; k--) delete O[k - 1];\n    } else if (insertCount > actualDeleteCount) {\n      for (k = len - actualDeleteCount; k > actualStart; k--) {\n        from = k + actualDeleteCount - 1;\n        to = k + insertCount - 1;\n        if (from in O) O[to] = O[from];\n        else delete O[to];\n      }\n    }\n    for (k = 0; k < insertCount; k++) {\n      O[k + actualStart] = arguments[k + 2];\n    }\n    O.length = len - actualDeleteCount + insertCount;\n    return A;\n  }\n});\n","// this method was added to unscopables after implementation\n// in popular engines, so it's moved to a separate module\nvar addToUnscopables = require('../internals/add-to-unscopables');\n\n// https://tc39.es/ecma262/#sec-array.prototype-@@unscopables\naddToUnscopables('flatMap');\n","import { User } from \"@/model/User\";\nimport { FirebaseDBService } from \"./FirebaseDBService\"\n\nexport class AdminService {\n\n    private db: FirebaseDBService;\n    // private store: Store<RootState>;\n\n    constructor() {\n        this.db = new FirebaseDBService();\n        // this.store = store;\n    }\n\n    async getAllUsers() {\n        const res = await this.db.readData<{ [uid: string]: User }>('users');\n        const users = [];\n        if (res) {\n            for (const uid in res) {\n                const user = { ...res[uid], uid };\n                users.push(user);\n            }\n        }\n        return users;\n    }\n\n    async getAllTopics() {\n        const res = await this.db.readData<{ [topic: string]: true }>('notifications/topics');\n        if (res) {\n            return Object.keys(res);\n        }\n        return [];\n    }\n\n    async getAllRoles(): Promise<{ [role: string]: string[]; }> {\n        const roles = await this.db.readData<{ [role: string]: Permission }>('permissions');\n        const formattedRoles: { [role: string]: string[] } = {};\n        if (roles) {\n            for (const role in roles) {\n                formattedRoles[role] = Object.keys(roles[role]);\n            }\n        }\n        return formattedRoles;\n    }\n\n    getTokensFromUsers(users: User[]) {\n        return users.flatMap((user) => {\n            if (user.notificationTokens) {\n                return Object.keys(user.notificationTokens);\n            }\n        });\n    }\n\n    async saveTopic(topic: string, tokens: string[]) {\n        const topicObj: { [topic: string]: true } = tokens.reduce(\n            (tObj: { [topic: string]: true }, t) => ({ ...tObj, [t]: true }), {}\n        );\n        this.db.writeData<{ [topic: string]: true }>(`notifications/topics/${topic}`, topicObj);\n    }\n\n}\n\nexport type Permission = {\n    [uid: string]: true;\n}\n","import { Message } from \"@/model/FcmMessage\";\n\nexport class NotificationService {\n\n    async sendNotification(message: Message) {\n        const myHeaders = new Headers();\n        myHeaders.append(\"Content-Type\", \"application/json\");\n\n        const raw = JSON.stringify(message);\n\n        const requestOptions = {\n            method: 'POST',\n            headers: myHeaders,\n            body: raw,\n        };\n\n        const res = await fetch(\"https://unruffled-liskov-633292.netlify.app/.netlify/functions/send\", requestOptions);\n        return await res.json();\n        \n    }\n    \n    async addToTopic(tokens: string[], topic: string) {\n        const myHeaders = new Headers();\n        myHeaders.append(\"Content-Type\", \"application/json\");\n        \n        const raw = JSON.stringify({tokens, topic});\n        \n        const requestOptions = {\n            method: 'POST',\n            headers: myHeaders,\n            body: raw,\n        };\n        \n        const res = await fetch(\"https://unruffled-liskov-633292.netlify.app/.netlify/functions/addToTopic\", requestOptions);\n        return await res.json();\n    }\n}","import { toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\"\n\nconst _withScopeId = n => (_pushScopeId(\"data-v-5543991e\"),n=n(),_popScopeId(),n)\nconst _hoisted_1 = { id: \"new_topic\" }\nconst _hoisted_2 = { class: \"desc\" }\nconst _hoisted_3 = { class: \"users_list\" }\nconst _hoisted_4 = [\"selected\", \"onClick\"]\nconst _hoisted_5 = /*#__PURE__*/ _withScopeId(() => /*#__PURE__*/_createElementVNode(\"div\", { class: \"divider\" }, null, -1))\nconst _hoisted_6 = { class: \"roles_list\" }\nconst _hoisted_7 = [\"selected\", \"onClick\"]\nconst _hoisted_8 = { class: \"desc\" }\nconst _hoisted_9 = [\"disabled\", \"loading\"]\n\nexport function render(_ctx: any,_cache: any,$props: any,$setup: any,$data: any,$options: any) {\n  return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n    _createElementVNode(\"div\", _hoisted_2, _toDisplayString(_ctx.$t.users), 1),\n    _createElementVNode(\"div\", _hoisted_3, [\n      (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_ctx.users, (user) => {\n        return (_openBlock(), _createElementBlock(\"div\", {\n          class: \"toggable\",\n          key: user.uid,\n          selected: this.selectedUsers.includes(user.uid),\n          onClick: ($event: any) => (_ctx.toggleFromList(user.uid, this.selectedUsers))\n        }, _toDisplayString(user.info ? user.info.mail : user.uid), 9, _hoisted_4))\n      }), 128))\n    ]),\n    _hoisted_5,\n    _createElementVNode(\"div\", _hoisted_6, [\n      (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_ctx.roles, (role, key) => {\n        return (_openBlock(), _createElementBlock(\"div\", {\n          class: \"toggable\",\n          key: role,\n          selected: this.selectedRole === key,\n          onClick: ($event: any) => (_ctx.toggleRole(key))\n        }, _toDisplayString(key), 9, _hoisted_7))\n      }), 128))\n    ]),\n    _createElementVNode(\"div\", _hoisted_8, _toDisplayString(_ctx.$t.topic), 1),\n    _createElementVNode(\"div\", {\n      class: \"input\",\n      contenteditable: \"true\",\n      inputmode: 'text',\n      onInput: _cache[0] || (_cache[0] = ($event: any) => (_ctx.topic = $event.target.innerText))\n    }, null, 32),\n    _createElementVNode(\"div\", {\n      class: \"submit_button\",\n      onClick: _cache[1] || (_cache[1] = \n//@ts-ignore\n(...args) => (_ctx.createTopic && _ctx.createTopic(...args))),\n      disabled: !_ctx.hasMandatoryFields(),\n      loading: _ctx.loading\n    }, _toDisplayString(_ctx.$t.newTopic), 9, _hoisted_9)\n  ]))\n}","\nimport { defineComponent } from \"vue\";\nimport { NotificationService } from \"@/services/NotificationService\";\nimport { AdminService } from \"@/services/AdminService\";\nimport { User } from \"@/model/User\";\n\nexport default defineComponent({\n  data() {\n    const users: (User & { uid: string })[] = [];\n    const roles: { [role: string]: string[] } = {};\n    const selectedUsers: string[] = [];\n    //const selectedRoles: string[] = [];\n    const selectedRole = \"\";\n    return {\n      topic: \"\",\n      users,\n      roles,\n      selectedUsers,\n      // selectedRoles,\n      selectedRole,\n      loading: false,\n    };\n  },\n  async mounted() {\n    const adminService = new AdminService();\n    this.users = await adminService.getAllUsers();\n    this.roles = await adminService.getAllRoles();\n  },\n  methods: {\n    hasMandatoryFields() {\n      return this.selectedUsers.length > 0 && this.topic !== \"\";\n    },\n    async createTopic() {\n      const tokens = this.users\n        .filter((u) => this.selectedUsers.includes(u.uid))\n        .flatMap((u) =>\n          Object.keys(u.notificationTokens ? u.notificationTokens : {})\n        );\n      if (this.topic !== \"\" && tokens.length > 0) {\n        this.loading = true;\n        await new NotificationService().addToTopic(tokens, this.topic);\n        await new AdminService().saveTopic(this.topic, tokens);\n        this.loading = false;\n        this.$router.back();\n      }\n    },\n    toggleFromList(el: string, list: string[]) {\n      const i = list.indexOf(el);\n      if (i >= 0) {\n        list.splice(i, 1);\n      } else {\n        list.push(el);\n      }\n    },\n    toggleRole(role: string) {\n      // this.toggleFromList(role, this.selectedRoles);\n      // this.roles[role].forEach((r) =>\n      //   this.toggleFromList(r, this.selectedUsers)\n      // );\n      if (this.selectedRole === role) {\n        this.selectedRole = \"\";\n        this.selectedUsers = [];\n      } else {\n        this.selectedRole = role;\n        this.selectedUsers = this.roles[role];\n      }\n    },\n  },\n});\n","import { render } from \"./NewTopic.vue?vue&type=template&id=5543991e&scoped=true&ts=true\"\nimport script from \"./NewTopic.vue?vue&type=script&lang=ts\"\nexport * from \"./NewTopic.vue?vue&type=script&lang=ts\"\n\nimport \"./NewTopic.vue?vue&type=style&index=0&id=5543991e&lang=scss&scoped=true\"\n\nimport exportComponent from \"/Users/TomaccioD/Documents/other/protezione-civile/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-5543991e\"]])\n\nexport default __exports__"],"names":["global","isArray","lengthOfArrayLike","bind","TypeError","flattenIntoArray","target","original","source","sourceLen","start","depth","mapper","thisArg","element","elementLen","targetIndex","sourceIndex","mapFn","module","exports","$","aCallable","toObject","arraySpeciesCreate","proto","flatMap","callbackfn","A","O","this","length","arguments","undefined","toAbsoluteIndex","toIntegerOrInfinity","createProperty","arrayMethodHasSpeciesSupport","HAS_SPECIES_SUPPORT","max","Math","min","MAX_SAFE_INTEGER","MAXIMUM_ALLOWED_LENGTH_EXCEEDED","forced","splice","deleteCount","insertCount","actualDeleteCount","k","from","to","len","actualStart","argumentsLength","addToUnscopables","AdminService","db","FirebaseDBService","readData","res","users","uid","user","push","Object","keys","roles","formattedRoles","role","notificationTokens","topic","tokens","topicObj","reduce","tObj","t","writeData","NotificationService","message","myHeaders","Headers","append","raw","JSON","stringify","requestOptions","method","headers","body","fetch","json","_withScopeId","n","_pushScopeId","_popScopeId","_hoisted_1","id","_hoisted_2","class","_hoisted_3","_hoisted_4","_hoisted_5","_createElementVNode","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","render","_ctx","_cache","$props","$setup","$data","$options","_openBlock","_createElementBlock","_toDisplayString","$t","_Fragment","_renderList","key","selected","selectedUsers","includes","onClick","$event","toggleFromList","info","mail","selectedRole","toggleRole","contenteditable","inputmode","onInput","innerText","createTopic","disabled","hasMandatoryFields","loading","newTopic","defineComponent","data","mounted","adminService","getAllUsers","getAllRoles","methods","filter","u","addToTopic","saveTopic","$router","back","el","list","i","indexOf","__exports__"],"sourceRoot":""}