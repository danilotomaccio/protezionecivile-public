(self["webpackChunkprotezione_civile"]=self["webpackChunkprotezione_civile"]||[]).push([[954],{6790:function(e,t,n){"use strict";var r=n(7854),i=n(3157),a=n(6244),o=n(9974),s=r.TypeError,c=function(e,t,n,r,u,p,d,l){var f,h,v=u,g=0,m=!!d&&o(d,l);while(g<r){if(g in n){if(f=m?m(n[g],g,t):n[g],p>0&&i(f))h=a(f),v=c(e,t,f,h,v,p-1)-1;else{if(v>=9007199254740991)throw s("Exceed the acceptable array length");e[v]=f}v++}g++}return v};e.exports=c},6535:function(e,t,n){"use strict";var r=n(2109),i=n(6790),a=n(9662),o=n(7908),s=n(6244),c=n(5417);r({target:"Array",proto:!0},{flatMap:function(e){var t,n=o(this),r=s(n);return a(e),t=c(n,0),t.length=i(t,n,n,r,0,1,e,arguments.length>1?arguments[1]:void 0),t}})},9244:function(e,t,n){var r=n(1223);r("flatMap")},591:function(e,t,n){"use strict";n.d(t,{l:function(){return u}});var r=n(2482),i=n(5082),a=n(8534),o=n(3087),s=n(2833),c=(n(7941),n(6535),n(9244),n(1539),n(5666),n(8907)),u=function(){function e(){(0,o.Z)(this,e),this.db=new c.B}return(0,s.Z)(e,[{key:"getAllUsers",value:function(){var e=(0,a.Z)(regeneratorRuntime.mark((function e(){var t,n,r,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.db.readData("users");case 2:if(t=e.sent,n=[],t)for(r in t)a=(0,i.Z)((0,i.Z)({},t[r]),{},{uid:r}),n.push(a);return e.abrupt("return",n);case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getAllTopics",value:function(){var e=(0,a.Z)(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.db.readData("notifications/topics");case 2:if(t=e.sent,!t){e.next=5;break}return e.abrupt("return",Object.keys(t));case 5:return e.abrupt("return",[]);case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getAllRoles",value:function(){var e=(0,a.Z)(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.db.readData("permissions");case 2:if(t=e.sent,n={},t)for(r in t)n[r]=Object.keys(t[r]);return e.abrupt("return",n);case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getTokensFromUsers",value:function(e){return e.flatMap((function(e){if(e.notificationTokens)return Object.keys(e.notificationTokens)}))}},{key:"saveTopic",value:function(){var e=(0,a.Z)(regeneratorRuntime.mark((function e(t,n){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:a=n.reduce((function(e,t){return(0,i.Z)((0,i.Z)({},e),{},(0,r.Z)({},t,!0))}),{}),this.db.writeData("notifications/topics/".concat(t),a);case 2:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()}]),e}()},297:function(e,t,n){"use strict";n.d(t,{g:function(){return o}});var r=n(8534),i=n(3087),a=n(2833),o=(n(5666),n(8862),n(1539),function(){function e(){(0,i.Z)(this,e)}return(0,a.Z)(e,[{key:"sendNotification",value:function(){var e=(0,r.Z)(regeneratorRuntime.mark((function e(t){var n,r,i,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=new Headers,n.append("Content-Type","application/json"),r=JSON.stringify(t),i={method:"POST",headers:n,body:r},e.next=6,fetch("https://unruffled-liskov-633292.netlify.app/.netlify/functions/send",i);case 6:return a=e.sent,e.next=9,a.json();case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"addToTopic",value:function(){var e=(0,r.Z)(regeneratorRuntime.mark((function e(t,n){var r,i,a,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=new Headers,r.append("Content-Type","application/json"),i=JSON.stringify({tokens:t,topic:n}),a={method:"POST",headers:r,body:i},e.next=6,fetch("https://unruffled-liskov-633292.netlify.app/.netlify/functions/addToTopic",a);case 6:return o=e.sent,e.next=9,o.json();case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e)})));function t(t,n){return e.apply(this,arguments)}return t}()}]),e}())},3954:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return y}});n(2526),n(1817);var r=n(6252),i=n(3577),a={id:"notifications"},o={class:"notification"},s={class:"desc",name:"title"},c={class:"desc",name:"desctiption"},u={class:"desc",name:"topic"},p={class:"topics_list"},d=["selected","onClick"],l=["disabled","loading"];function f(e,t,n,f,h,v){var g=this;return(0,r.wg)(),(0,r.iD)("div",a,[(0,r._)("div",o,[(0,r._)("div",s,(0,i.zw)(e.$t.title),1),(0,r._)("div",{class:"input",contenteditable:"true",inputmode:"text",onInput:t[0]||(t[0]=function(t){return e.message.title=t.target.innerText})},null,32),(0,r._)("div",c,(0,i.zw)(e.$t.description),1),(0,r._)("div",{class:"input",contenteditable:"true",inputmode:"text",onInput:t[1]||(t[1]=function(t){return e.message.description=t.target.innerText})},null,32)]),(0,r._)("div",u,(0,i.zw)(e.$t.topic),1),(0,r._)("div",p,[((0,r.wg)(!0),(0,r.iD)(r.HY,null,(0,r.Ko)(e.topics,(function(t){return(0,r.wg)(),(0,r.iD)("div",{class:"topic",key:t,selected:e.selectedTopic===t,onClick:function(){return e.selectedTopic=e.selectedTopic===t?"":t}},(0,i.zw)(t),9,d)})),128)),(0,r._)("div",{class:"topic new_topic_button",onClick:t[2]||(t[2]=function(){return g.$router.push("/admin/notifications/newTopic")})},(0,i.zw)(e.$t.newTopic),1)]),(0,r._)("div",{class:"submit_button",onClick:t[3]||(t[3]=function(){return e.sendPushNotification&&e.sendPushNotification.apply(e,arguments)}),disabled:!e.hasMandatoryFields(),loading:e.loading},(0,i.zw)(e.loading?e.$t.sendingNotification:e.$t.sendNotification),9,l)])}var h=n(8534),v=(n(5666),n(297)),g=n(591),m=(0,r.aZ)({data:function(){var e={},t=[];return{message:e,topics:t,selectedTopic:t[0],loading:!1}},mounted:function(){var e=this;return(0,h.Z)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,(new g.l).getAllTopics();case 2:e.topics=t.sent;case 3:case"end":return t.stop()}}),t)})))()},methods:{hasMandatoryFields:function(){return this.selectedTopic&&this.message.title&&this.message.description},sendPushNotification:function(){var e=this;return(0,h.Z)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.hasMandatoryFields()){t.next=6;break}return e.loading=!0,n={topic:e.selectedTopic,webpush:{notification:{title:e.message.title,body:e.message.description,icon:"https://app.protezioneciviletricarico.com/img/icons/android-chrome-192x192.png",color:"#7e55c3",badge:"https://app.protezioneciviletricarico.com/img/icons/android-chrome-192x192.png"}}},t.next=5,(new v.g).sendNotification(n);case 5:e.loading=!1;case 6:case"end":return t.stop()}}),t)})))()}}}),w=n(3744);const k=(0,w.Z)(m,[["render",f],["__scopeId","data-v-3f7a9a91"]]);var y=k}}]);
//# sourceMappingURL=954-legacy.74e64f44.js.map