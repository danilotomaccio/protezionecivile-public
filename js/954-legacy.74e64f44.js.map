{"version":3,"file":"js/954-legacy.74e64f44.js","mappings":"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","sources":["webpack://protezione-civile/./node_modules/core-js/internals/flatten-into-array.js","webpack://protezione-civile/./node_modules/core-js/modules/es.array.flat-map.js","webpack://protezione-civile/./node_modules/core-js/modules/es.array.unscopables.flat-map.js","webpack://protezione-civile/./src/services/AdminService.ts","webpack://protezione-civile/./src/services/NotificationService.ts","webpack://protezione-civile/./src/views/AdminNotifications.vue?6120","webpack://protezione-civile/./src/views/AdminNotifications.vue?8c1f","webpack://protezione-civile/./src/views/AdminNotifications.vue"],"sourcesContent":["'use strict';\nvar global = require('../internals/global');\nvar isArray = require('../internals/is-array');\nvar lengthOfArrayLike = require('../internals/length-of-array-like');\nvar bind = require('../internals/function-bind-context');\n\nvar TypeError = global.TypeError;\n\n// `FlattenIntoArray` abstract operation\n// https://tc39.github.io/proposal-flatMap/#sec-FlattenIntoArray\nvar flattenIntoArray = function (target, original, source, sourceLen, start, depth, mapper, thisArg) {\n  var targetIndex = start;\n  var sourceIndex = 0;\n  var mapFn = mapper ? bind(mapper, thisArg) : false;\n  var element, elementLen;\n\n  while (sourceIndex < sourceLen) {\n    if (sourceIndex in source) {\n      element = mapFn ? mapFn(source[sourceIndex], sourceIndex, original) : source[sourceIndex];\n\n      if (depth > 0 && isArray(element)) {\n        elementLen = lengthOfArrayLike(element);\n        targetIndex = flattenIntoArray(target, original, element, elementLen, targetIndex, depth - 1) - 1;\n      } else {\n        if (targetIndex >= 0x1FFFFFFFFFFFFF) throw TypeError('Exceed the acceptable array length');\n        target[targetIndex] = element;\n      }\n\n      targetIndex++;\n    }\n    sourceIndex++;\n  }\n  return targetIndex;\n};\n\nmodule.exports = flattenIntoArray;\n","'use strict';\nvar $ = require('../internals/export');\nvar flattenIntoArray = require('../internals/flatten-into-array');\nvar aCallable = require('../internals/a-callable');\nvar toObject = require('../internals/to-object');\nvar lengthOfArrayLike = require('../internals/length-of-array-like');\nvar arraySpeciesCreate = require('../internals/array-species-create');\n\n// `Array.prototype.flatMap` method\n// https://tc39.es/ecma262/#sec-array.prototype.flatmap\n$({ target: 'Array', proto: true }, {\n  flatMap: function flatMap(callbackfn /* , thisArg */) {\n    var O = toObject(this);\n    var sourceLen = lengthOfArrayLike(O);\n    var A;\n    aCallable(callbackfn);\n    A = arraySpeciesCreate(O, 0);\n    A.length = flattenIntoArray(A, O, O, sourceLen, 0, 1, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n    return A;\n  }\n});\n","// this method was added to unscopables after implementation\n// in popular engines, so it's moved to a separate module\nvar addToUnscopables = require('../internals/add-to-unscopables');\n\n// https://tc39.es/ecma262/#sec-array.prototype-@@unscopables\naddToUnscopables('flatMap');\n","import { User } from \"@/model/User\";\nimport { FirebaseDBService } from \"./FirebaseDBService\"\n\nexport class AdminService {\n\n    private db: FirebaseDBService;\n    // private store: Store<RootState>;\n\n    constructor() {\n        this.db = new FirebaseDBService();\n        // this.store = store;\n    }\n\n    async getAllUsers() {\n        const res = await this.db.readData<{ [uid: string]: User }>('users');\n        const users = [];\n        if (res) {\n            for (const uid in res) {\n                const user = { ...res[uid], uid };\n                users.push(user);\n            }\n        }\n        return users;\n    }\n\n    async getAllTopics() {\n        const res = await this.db.readData<{ [topic: string]: true }>('notifications/topics');\n        if (res) {\n            return Object.keys(res);\n        }\n        return [];\n    }\n\n    async getAllRoles(): Promise<{ [role: string]: string[]; }> {\n        const roles = await this.db.readData<{ [role: string]: Permission }>('permissions');\n        const formattedRoles: { [role: string]: string[] } = {};\n        if (roles) {\n            for (const role in roles) {\n                formattedRoles[role] = Object.keys(roles[role]);\n            }\n        }\n        return formattedRoles;\n    }\n\n    getTokensFromUsers(users: User[]) {\n        return users.flatMap((user) => {\n            if (user.notificationTokens) {\n                return Object.keys(user.notificationTokens);\n            }\n        });\n    }\n\n    async saveTopic(topic: string, tokens: string[]) {\n        const topicObj: { [topic: string]: true } = tokens.reduce(\n            (tObj: { [topic: string]: true }, t) => ({ ...tObj, [t]: true }), {}\n        );\n        this.db.writeData<{ [topic: string]: true }>(`notifications/topics/${topic}`, topicObj);\n    }\n\n}\n\nexport type Permission = {\n    [uid: string]: true;\n}\n","import { Message } from \"@/model/FcmMessage\";\n\nexport class NotificationService {\n\n    async sendNotification(message: Message) {\n        const myHeaders = new Headers();\n        myHeaders.append(\"Content-Type\", \"application/json\");\n\n        const raw = JSON.stringify(message);\n\n        const requestOptions = {\n            method: 'POST',\n            headers: myHeaders,\n            body: raw,\n        };\n\n        const res = await fetch(\"https://unruffled-liskov-633292.netlify.app/.netlify/functions/send\", requestOptions);\n        return await res.json();\n        \n    }\n    \n    async addToTopic(tokens: string[], topic: string) {\n        const myHeaders = new Headers();\n        myHeaders.append(\"Content-Type\", \"application/json\");\n        \n        const raw = JSON.stringify({tokens, topic});\n        \n        const requestOptions = {\n            method: 'POST',\n            headers: myHeaders,\n            body: raw,\n        };\n        \n        const res = await fetch(\"https://unruffled-liskov-633292.netlify.app/.netlify/functions/addToTopic\", requestOptions);\n        return await res.json();\n    }\n}","import { toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\"\n\nconst _withScopeId = n => (_pushScopeId(\"data-v-3f7a9a91\"),n=n(),_popScopeId(),n)\nconst _hoisted_1 = { id: \"notifications\" }\nconst _hoisted_2 = { class: \"notification\" }\nconst _hoisted_3 = {\n  class: \"desc\",\n  name: \"title\"\n}\nconst _hoisted_4 = {\n  class: \"desc\",\n  name: \"desctiption\"\n}\nconst _hoisted_5 = {\n  class: \"desc\",\n  name: \"topic\"\n}\nconst _hoisted_6 = { class: \"topics_list\" }\nconst _hoisted_7 = [\"selected\", \"onClick\"]\nconst _hoisted_8 = [\"disabled\", \"loading\"]\n\nexport function render(_ctx: any,_cache: any,$props: any,$setup: any,$data: any,$options: any) {\n  return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n    _createElementVNode(\"div\", _hoisted_2, [\n      _createElementVNode(\"div\", _hoisted_3, _toDisplayString(_ctx.$t.title), 1),\n      _createElementVNode(\"div\", {\n        class: \"input\",\n        contenteditable: \"true\",\n        inputmode: 'text',\n        onInput: _cache[0] || (_cache[0] = ($event: any) => (_ctx.message.title = $event.target.innerText))\n      }, null, 32),\n      _createElementVNode(\"div\", _hoisted_4, _toDisplayString(_ctx.$t.description), 1),\n      _createElementVNode(\"div\", {\n        class: \"input\",\n        contenteditable: \"true\",\n        inputmode: 'text',\n        onInput: _cache[1] || (_cache[1] = ($event: any) => (_ctx.message.description = $event.target.innerText))\n      }, null, 32)\n    ]),\n    _createElementVNode(\"div\", _hoisted_5, _toDisplayString(_ctx.$t.topic), 1),\n    _createElementVNode(\"div\", _hoisted_6, [\n      (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_ctx.topics, (topic) => {\n        return (_openBlock(), _createElementBlock(\"div\", {\n          class: \"topic\",\n          key: topic,\n          selected: _ctx.selectedTopic === topic,\n          onClick: () => (_ctx.selectedTopic = _ctx.selectedTopic === topic ? '' : topic)\n        }, _toDisplayString(topic), 9, _hoisted_7))\n      }), 128)),\n      _createElementVNode(\"div\", {\n        class: \"topic new_topic_button\",\n        onClick: _cache[2] || (_cache[2] = () => this.$router.push('/admin/notifications/newTopic'))\n      }, _toDisplayString(_ctx.$t.newTopic), 1)\n    ]),\n    _createElementVNode(\"div\", {\n      class: \"submit_button\",\n      onClick: _cache[3] || (_cache[3] = \n//@ts-ignore\n(...args) => (_ctx.sendPushNotification && _ctx.sendPushNotification(...args))),\n      disabled: !_ctx.hasMandatoryFields(),\n      loading: _ctx.loading\n    }, _toDisplayString(_ctx.loading ? _ctx.$t.sendingNotification : _ctx.$t.sendNotification), 9, _hoisted_8)\n  ]))\n}","\nimport { defineComponent } from \"vue\";\nimport { NotificationService } from \"@/services/NotificationService\";\nimport { Message } from \"@/model/FcmMessage\";\nimport { AdminService } from \"@/services/AdminService\";\n\nexport default defineComponent({\n  data() {\n    const message: { topic?: string; title?: string; description?: string } =\n      {};\n    const topics: string[] = [];\n    return { message, topics, selectedTopic: topics[0], loading: false };\n  },\n  async mounted() {\n    this.topics = await new AdminService().getAllTopics();\n  },\n  methods: {\n    hasMandatoryFields() {\n      return (\n        this.selectedTopic && this.message.title && this.message.description\n      );\n    },\n    async sendPushNotification() {\n      if (this.hasMandatoryFields()) {\n        this.loading = true;\n        const msg: Message = {\n          topic: this.selectedTopic,\n          webpush: {\n            notification: {\n              title: this.message.title,\n              body: this.message.description,\n              icon: \"https://app.protezioneciviletricarico.com/img/icons/android-chrome-192x192.png\",\n              color: \"#7e55c3\",\n              badge:\n                \"https://app.protezioneciviletricarico.com/img/icons/android-chrome-192x192.png\",\n              // actions: [{ action: \"goTo\", title: \"Prova\" }],\n            },\n          },\n        };\n        await new NotificationService().sendNotification(msg);\n        this.loading = false;\n      }\n    },\n  },\n});\n","import { render } from \"./AdminNotifications.vue?vue&type=template&id=3f7a9a91&scoped=true&ts=true\"\nimport script from \"./AdminNotifications.vue?vue&type=script&lang=ts\"\nexport * from \"./AdminNotifications.vue?vue&type=script&lang=ts\"\n\nimport \"./AdminNotifications.vue?vue&type=style&index=0&id=3f7a9a91&lang=scss&scoped=true\"\n\nimport exportComponent from \"/Users/TomaccioD/Documents/other/protezione-civile/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-3f7a9a91\"]])\n\nexport default __exports__"],"names":["global","isArray","lengthOfArrayLike","bind","TypeError","flattenIntoArray","target","original","source","sourceLen","start","depth","mapper","thisArg","element","elementLen","targetIndex","sourceIndex","mapFn","module","exports","$","aCallable","toObject","arraySpeciesCreate","proto","flatMap","callbackfn","A","O","this","length","arguments","undefined","addToUnscopables","AdminService","db","FirebaseDBService","readData","res","users","uid","user","push","Object","keys","roles","formattedRoles","role","notificationTokens","topic","tokens","topicObj","reduce","tObj","t","writeData","NotificationService","message","myHeaders","Headers","append","raw","JSON","stringify","requestOptions","method","headers","body","fetch","json","_hoisted_1","id","_hoisted_2","class","_hoisted_3","name","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","render","_ctx","_cache","$props","$setup","$data","$options","_openBlock","_createElementBlock","_createElementVNode","_toDisplayString","$t","title","contenteditable","inputmode","onInput","$event","innerText","description","_Fragment","_renderList","topics","key","selected","selectedTopic","onClick","$router","newTopic","sendPushNotification","disabled","hasMandatoryFields","loading","sendingNotification","sendNotification","defineComponent","data","mounted","getAllTopics","methods","msg","webpush","notification","icon","color","badge","__exports__"],"sourceRoot":""}