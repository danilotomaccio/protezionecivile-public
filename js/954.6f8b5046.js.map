{"version":3,"file":"js/954.6f8b5046.js","mappings":"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","sources":["webpack://protezione-civile/./src/services/AdminService.ts","webpack://protezione-civile/./src/services/NotificationService.ts","webpack://protezione-civile/./src/views/AdminNotifications.vue?6120","webpack://protezione-civile/./src/views/AdminNotifications.vue?8c1f","webpack://protezione-civile/./src/views/AdminNotifications.vue"],"sourcesContent":["import { User } from \"@/model/User\";\nimport { FirebaseDBService } from \"./FirebaseDBService\"\n\nexport class AdminService {\n\n    private db: FirebaseDBService;\n    // private store: Store<RootState>;\n\n    constructor() {\n        this.db = new FirebaseDBService();\n        // this.store = store;\n    }\n\n    async getAllUsers() {\n        const res = await this.db.readData<{ [uid: string]: User }>('users');\n        const users = [];\n        if (res) {\n            for (const uid in res) {\n                const user = { ...res[uid], uid };\n                users.push(user);\n            }\n        }\n        return users;\n    }\n\n    async getAllTopics() {\n        const res = await this.db.readData<{ [topic: string]: true }>('notifications/topics');\n        if (res) {\n            return Object.keys(res);\n        }\n        return [];\n    }\n\n    async getAllRoles(): Promise<{ [role: string]: string[]; }> {\n        const roles = await this.db.readData<{ [role: string]: Permission }>('permissions');\n        const formattedRoles: { [role: string]: string[] } = {};\n        if (roles) {\n            for (const role in roles) {\n                formattedRoles[role] = Object.keys(roles[role]);\n            }\n        }\n        return formattedRoles;\n    }\n\n    getTokensFromUsers(users: User[]) {\n        return users.flatMap((user) => {\n            if (user.notificationTokens) {\n                return Object.keys(user.notificationTokens);\n            }\n        });\n    }\n\n    async saveTopic(topic: string, tokens: string[]) {\n        const topicObj: { [topic: string]: true } = tokens.reduce(\n            (tObj: { [topic: string]: true }, t) => ({ ...tObj, [t]: true }), {}\n        );\n        this.db.writeData<{ [topic: string]: true }>(`notifications/topics/${topic}`, topicObj);\n    }\n\n}\n\nexport type Permission = {\n    [uid: string]: true;\n}\n","import { Message } from \"@/model/FcmMessage\";\n\nexport class NotificationService {\n\n    async sendNotification(message: Message) {\n        const myHeaders = new Headers();\n        myHeaders.append(\"Content-Type\", \"application/json\");\n\n        const raw = JSON.stringify(message);\n\n        const requestOptions = {\n            method: 'POST',\n            headers: myHeaders,\n            body: raw,\n        };\n\n        const res = await fetch(\"https://unruffled-liskov-633292.netlify.app/.netlify/functions/send\", requestOptions);\n        return await res.json();\n        \n    }\n    \n    async addToTopic(tokens: string[], topic: string) {\n        const myHeaders = new Headers();\n        myHeaders.append(\"Content-Type\", \"application/json\");\n        \n        const raw = JSON.stringify({tokens, topic});\n        \n        const requestOptions = {\n            method: 'POST',\n            headers: myHeaders,\n            body: raw,\n        };\n        \n        const res = await fetch(\"https://unruffled-liskov-633292.netlify.app/.netlify/functions/addToTopic\", requestOptions);\n        return await res.json();\n    }\n}","import { toDisplayString as _toDisplayString, createElementVNode as _createElementVNode, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\"\n\nconst _withScopeId = n => (_pushScopeId(\"data-v-3f7a9a91\"),n=n(),_popScopeId(),n)\nconst _hoisted_1 = { id: \"notifications\" }\nconst _hoisted_2 = { class: \"notification\" }\nconst _hoisted_3 = {\n  class: \"desc\",\n  name: \"title\"\n}\nconst _hoisted_4 = {\n  class: \"desc\",\n  name: \"desctiption\"\n}\nconst _hoisted_5 = {\n  class: \"desc\",\n  name: \"topic\"\n}\nconst _hoisted_6 = { class: \"topics_list\" }\nconst _hoisted_7 = [\"selected\", \"onClick\"]\nconst _hoisted_8 = [\"disabled\", \"loading\"]\n\nexport function render(_ctx: any,_cache: any,$props: any,$setup: any,$data: any,$options: any) {\n  return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n    _createElementVNode(\"div\", _hoisted_2, [\n      _createElementVNode(\"div\", _hoisted_3, _toDisplayString(_ctx.$t.title), 1),\n      _createElementVNode(\"div\", {\n        class: \"input\",\n        contenteditable: \"true\",\n        inputmode: 'text',\n        onInput: _cache[0] || (_cache[0] = ($event: any) => (_ctx.message.title = $event.target.innerText))\n      }, null, 32),\n      _createElementVNode(\"div\", _hoisted_4, _toDisplayString(_ctx.$t.description), 1),\n      _createElementVNode(\"div\", {\n        class: \"input\",\n        contenteditable: \"true\",\n        inputmode: 'text',\n        onInput: _cache[1] || (_cache[1] = ($event: any) => (_ctx.message.description = $event.target.innerText))\n      }, null, 32)\n    ]),\n    _createElementVNode(\"div\", _hoisted_5, _toDisplayString(_ctx.$t.topic), 1),\n    _createElementVNode(\"div\", _hoisted_6, [\n      (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_ctx.topics, (topic) => {\n        return (_openBlock(), _createElementBlock(\"div\", {\n          class: \"topic\",\n          key: topic,\n          selected: _ctx.selectedTopic === topic,\n          onClick: () => (_ctx.selectedTopic = _ctx.selectedTopic === topic ? '' : topic)\n        }, _toDisplayString(topic), 9, _hoisted_7))\n      }), 128)),\n      _createElementVNode(\"div\", {\n        class: \"topic new_topic_button\",\n        onClick: _cache[2] || (_cache[2] = () => this.$router.push('/admin/notifications/newTopic'))\n      }, _toDisplayString(_ctx.$t.newTopic), 1)\n    ]),\n    _createElementVNode(\"div\", {\n      class: \"submit_button\",\n      onClick: _cache[3] || (_cache[3] = \n//@ts-ignore\n(...args) => (_ctx.sendPushNotification && _ctx.sendPushNotification(...args))),\n      disabled: !_ctx.hasMandatoryFields(),\n      loading: _ctx.loading\n    }, _toDisplayString(_ctx.loading ? _ctx.$t.sendingNotification : _ctx.$t.sendNotification), 9, _hoisted_8)\n  ]))\n}","\nimport { defineComponent } from \"vue\";\nimport { NotificationService } from \"@/services/NotificationService\";\nimport { Message } from \"@/model/FcmMessage\";\nimport { AdminService } from \"@/services/AdminService\";\n\nexport default defineComponent({\n  data() {\n    const message: { topic?: string; title?: string; description?: string } =\n      {};\n    const topics: string[] = [];\n    return { message, topics, selectedTopic: topics[0], loading: false };\n  },\n  async mounted() {\n    this.topics = await new AdminService().getAllTopics();\n  },\n  methods: {\n    hasMandatoryFields() {\n      return (\n        this.selectedTopic && this.message.title && this.message.description\n      );\n    },\n    async sendPushNotification() {\n      if (this.hasMandatoryFields()) {\n        this.loading = true;\n        const msg: Message = {\n          topic: this.selectedTopic,\n          webpush: {\n            notification: {\n              title: this.message.title,\n              body: this.message.description,\n              icon: \"https://app.protezioneciviletricarico.com/img/icons/android-chrome-192x192.png\",\n              color: \"#7e55c3\",\n              badge:\n                \"https://app.protezioneciviletricarico.com/img/icons/android-chrome-192x192.png\",\n              // actions: [{ action: \"goTo\", title: \"Prova\" }],\n            },\n          },\n        };\n        await new NotificationService().sendNotification(msg);\n        this.loading = false;\n      }\n    },\n  },\n});\n","import { render } from \"./AdminNotifications.vue?vue&type=template&id=3f7a9a91&scoped=true&ts=true\"\nimport script from \"./AdminNotifications.vue?vue&type=script&lang=ts\"\nexport * from \"./AdminNotifications.vue?vue&type=script&lang=ts\"\n\nimport \"./AdminNotifications.vue?vue&type=style&index=0&id=3f7a9a91&lang=scss&scoped=true\"\n\nimport exportComponent from \"/Users/TomaccioD/Documents/other/protezione-civile/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render],['__scopeId',\"data-v-3f7a9a91\"]])\n\nexport default __exports__"],"names":["AdminService","constructor","this","db","FirebaseDBService","res","readData","users","uid","user","push","Object","keys","roles","formattedRoles","role","getTokensFromUsers","flatMap","notificationTokens","topic","tokens","topicObj","reduce","tObj","t","writeData","NotificationService","message","myHeaders","Headers","append","raw","JSON","stringify","requestOptions","method","headers","body","fetch","json","_hoisted_1","id","_hoisted_2","class","_hoisted_3","name","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","render","_ctx","_cache","$props","$setup","$data","$options","_openBlock","_createElementBlock","_createElementVNode","_toDisplayString","$t","title","contenteditable","inputmode","onInput","$event","target","innerText","description","_Fragment","_renderList","topics","key","selected","selectedTopic","onClick","$router","newTopic","args","sendPushNotification","disabled","hasMandatoryFields","loading","sendingNotification","sendNotification","defineComponent","data","async","getAllTopics","methods","msg","webpush","notification","icon","color","badge","__exports__"],"sourceRoot":""}