"use strict";(self["webpackChunkprotezione_civile"]=self["webpackChunkprotezione_civile"]||[]).push([[954],{591:function(t,i,e){e.d(i,{l:function(){return s}});var n=e(8907);class s{constructor(){this.db=new n.B}async getAllUsers(){const t=await this.db.readData("users"),i=[];if(t)for(const e in t){const n={...t[e],uid:e};i.push(n)}return i}async getAllTopics(){const t=await this.db.readData("notifications/topics");return t?Object.keys(t):[]}async getAllRoles(){const t=await this.db.readData("permissions"),i={};if(t)for(const e in t)i[e]=Object.keys(t[e]);return i}getTokensFromUsers(t){return t.flatMap((t=>{if(t.notificationTokens)return Object.keys(t.notificationTokens)}))}async saveTopic(t,i){const e=i.reduce(((t,i)=>({...t,[i]:!0})),{});this.db.writeData(`notifications/topics/${t}`,e)}}},297:function(t,i,e){e.d(i,{g:function(){return n}});class n{async sendNotification(t){const i=new Headers;i.append("Content-Type","application/json");const e=JSON.stringify(t),n={method:"POST",headers:i,body:e},s=await fetch("https://unruffled-liskov-633292.netlify.app/.netlify/functions/send",n);return await s.json()}async addToTopic(t,i){const e=new Headers;e.append("Content-Type","application/json");const n=JSON.stringify({tokens:t,topic:i}),s={method:"POST",headers:e,body:n},o=await fetch("https://unruffled-liskov-633292.netlify.app/.netlify/functions/addToTopic",s);return await o.json()}}},3954:function(t,i,e){e.r(i),e.d(i,{default:function(){return T}});var n=e(6252),s=e(3577);const o={id:"notifications"},c={class:"notification"},a={class:"desc",name:"title"},d={class:"desc",name:"desctiption"},r={class:"desc",name:"topic"},l={class:"topics_list"},p=["selected","onClick"],u=["disabled","loading"];function f(t,i,e,f,h,g){return(0,n.wg)(),(0,n.iD)("div",o,[(0,n._)("div",c,[(0,n._)("div",a,(0,s.zw)(t.$t.title),1),(0,n._)("div",{class:"input",contenteditable:"true",inputmode:"text",onInput:i[0]||(i[0]=i=>t.message.title=i.target.innerText)},null,32),(0,n._)("div",d,(0,s.zw)(t.$t.description),1),(0,n._)("div",{class:"input",contenteditable:"true",inputmode:"text",onInput:i[1]||(i[1]=i=>t.message.description=i.target.innerText)},null,32)]),(0,n._)("div",r,(0,s.zw)(t.$t.topic),1),(0,n._)("div",l,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(t.topics,(i=>((0,n.wg)(),(0,n.iD)("div",{class:"topic",key:i,selected:t.selectedTopic===i,onClick:()=>t.selectedTopic=t.selectedTopic===i?"":i},(0,s.zw)(i),9,p)))),128)),(0,n._)("div",{class:"topic new_topic_button",onClick:i[2]||(i[2]=()=>this.$router.push("/admin/notifications/newTopic"))},(0,s.zw)(t.$t.newTopic),1)]),(0,n._)("div",{class:"submit_button",onClick:i[3]||(i[3]=(...i)=>t.sendPushNotification&&t.sendPushNotification(...i)),disabled:!t.hasMandatoryFields(),loading:t.loading},(0,s.zw)(t.loading?t.$t.sendingNotification:t.$t.sendNotification),9,u)])}var h=e(297),g=e(591),w=(0,n.aZ)({data(){const t={},i=[];return{message:t,topics:i,selectedTopic:i[0],loading:!1}},async mounted(){this.topics=await(new g.l).getAllTopics()},methods:{hasMandatoryFields(){return this.selectedTopic&&this.message.title&&this.message.description},async sendPushNotification(){if(this.hasMandatoryFields()){this.loading=!0;const t={topic:this.selectedTopic,webpush:{notification:{title:this.message.title,body:this.message.description,icon:"https://app.protezioneciviletricarico.com/img/icons/android-chrome-192x192.png",color:"#7e55c3",badge:"https://app.protezioneciviletricarico.com/img/icons/android-chrome-192x192.png"}}};await(new h.g).sendNotification(t),this.loading=!1}}}}),m=e(3744);const y=(0,m.Z)(w,[["render",f],["__scopeId","data-v-3f7a9a91"]]);var T=y}}]);
//# sourceMappingURL=954.6f8b5046.js.map